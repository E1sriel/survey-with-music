<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>问卷测试与音乐播放</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:,">
    <style>
        /* 新增移动端播放控件 */
        #mobile-controls {
            display: none;
            margin-top: 10px;
            gap: 10px;
        }
        @media (max-width: 768px) {
            #mobile-controls { display: flex; }
            audio::-webkit-media-controls { display: none; }
        }
    </style>
</head>
<body>
    <div class="questionnaire-container">
        <iframe src="https://www.wjx.cn/vm/PpX1K07.aspx" 
                frameborder="0" 
                style="width:100%;height:80vh">
        </iframe>
    </div>

    <div id="music-player">
        <div id="song-title">当前播放：请选择音乐</div>
        <select id="music-selector">
            <option value="">-- 选择背景音乐 --</option>
            <option value="CMJ - 所念皆星河.mp3">所念皆星河</option>
            <option value="AniFace - 夜、萤火虫和你.mp3">夜、萤火虫和你</option>
            <option value="羽肿 - 花火が瞬く夜に.mp3">花火が瞬く夜に</option>
            <option value="凤凰院零零 - Tyndall effect (丁达尔效应).mp3">丁达尔效应</option>
        </select>
        
        <!-- 新增移动端控制按钮 -->
        <div id="mobile-controls">
            <button id="play-btn">▶️ 播放</button>
            <button id="pause-btn">⏸️ 暂停</button>
        </div>
        
        <audio id="audio-player" controls></audio>
    </div>

    <script>
        // 全局音频管理
        const audioManager = {
            currentAudio: null,
            isMobile: /Mobi|Android/i.test(navigator.userAgent),
            
            init: function() {
                this.createAudioElement();
                this.bindEvents();
            },
            
            createAudioElement: function() {
                if (this.currentAudio) {
                    this.currentAudio.pause();
                    this.currentAudio.remove();
                }
                this.currentAudio = new Audio();
                this.currentAudio.loop = true;
                this.currentAudio.controls = !this.isMobile;
                document.getElementById('audio-player').replaceWith(this.currentAudio);
            },
            
            load: function(filename) {
                if (!filename) return;
                
                this.createAudioElement();
                const path = `assets/music/${encodeURIComponent(filename)}`;
                this.currentAudio.src = path;
                
                // 更新显示信息
                const displayName = filename.split(' - ')[1]?.replace('.mp3', '') || filename;
                document.getElementById('song-title').textContent = `当前播放：${displayName}`;
                
                // 移动端显示自定义控件
                if (this.isMobile) {
                    this.currentAudio.style.display = 'none';
                    document.getElementById('mobile-controls').style.display = 'flex';
                }
            },
            
            bindEvents: function() {
                // 音乐切换
                document.getElementById('music-selector').addEventListener('change', e => {
                    this.load(e.target.value);
                });
                
                // 自定义播放控制
                document.getElementById('play-btn').addEventListener('click', () => {
                    this.currentAudio.play();
                });
                document.getElementById('pause-btn').addEventListener('click', () => {
                    this.currentAudio.pause();
                });
                
                // 阻止自动播放
                this.currentAudio.addEventListener('play', () => {
                    if (!document.querySelector('#music-player').matches(':hover')) {
                        this.currentAudio.pause();
                    }
                });
            }
        };

        // 初始化（不自动播放）
        audioManager.init();
        document.getElementById('music-selector').value = '';
    </script>
</body>
</html>
